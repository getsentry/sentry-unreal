name: "Lint"
on:
  push:

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.ref_name }}
          fetch-depth: 0

      - name: Check BOM
        run: |
          echo "Checking for BOM (Byte Order Mark) in source files..."
          files_with_bom=$(find plugin-dev/Source/Sentry plugin-dev/Source/SentryEditor -name "*.h" -o -name "*.cpp" | xargs grep -l $'\xef\xbb\xbf' 2>/dev/null || true)          
          if [ -n "$files_with_bom" ]; then
            echo "ERROR: Found files with BOM (Byte Order Mark). Please remove BOM from source files."
            echo "$files_with_bom"
            exit 1
          fi          
          echo "âœ“ All source files have no BOM."

      - name: Clang Format
        run: find plugin-dev/Source/Sentry plugin-dev/Source/SentryEditor -name '*.h' -o -name '*.cpp' | xargs /usr/bin/clang-format -i --Werror

      - name: Commit Formatted Code
        env:
          GITHUB_BRANCH: ${{ github.ref }}
        run: ./scripts/commit-formatted-code.sh $GITHUB_BRANCH